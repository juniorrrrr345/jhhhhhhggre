nohup: ignoring input
ğŸ”„ Tentative de connexion MongoDB #1...
âœ… MongoDB connectÃ© avec succÃ¨s
âœ… MongoDB connectÃ©: tesye-shard-00-00.qazpla.mongodb.net
ğŸ“Š Loaded 0 existing users from database
â„¹ï¸ Configuration existante trouvÃ©e
ğŸŒ Initialisation des traductions...
ğŸŒ Initialisation des traductions...
âœ… Traductions par dÃ©faut initialisÃ©es
âœ… Traductions initialisÃ©es
ğŸ”„ Migration automatique des rÃ©seaux sociaux...
ğŸ”— Connexion Ã  MongoDB rÃ©ussie
ğŸ“‹ 1 plugs trouvÃ©s
ğŸ‰ Migration terminÃ©e: 0 plugs migrÃ©s
âœ… Migration terminÃ©e avec succÃ¨s
ğŸ”„ Initialisation du cache...
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
âœ… Cache initialisÃ© et programmÃ© pour se rafraÃ®chir toutes les 30s
âœ… Bot en mode polling (dÃ©veloppement)
âœ… Serveur dÃ©marrÃ© sur le port 3023
ğŸ“± Bot Telegram connectÃ©
ğŸŒ API disponible sur http://localhost:3023
ğŸ“Š Cache: 1 plugs, config: OK
ğŸ“¡ GET /api/public/plugs - IP: ::1 - UserAgent: curl/8.12.1
ğŸ“‹ Headers: [ 'host', 'user-agent', 'accept' ]
ğŸ“¡ POST /api/likes/68835c4222586e073b5d57c3 - IP: ::1 - UserAgent: curl/8.12.1
ğŸ“‹ Headers: [ 'host', 'user-agent', 'accept', 'content-type', 'content-length' ]
ğŸ”„ API LIKE: like pour plug 68835c4222586e073b5d57c3 par user 123456789
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
âœ… API LIKE: like rÃ©ussi pour teste. Nouveaux likes: 2
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸš€ Commande /start reÃ§ue de: 7670522278
âŒ Erreur lors de l'enregistrement utilisateur: StrictModeError: Path "userId" is not in schema, strict mode is `true`, and upsert is `true`.
    at cast (/workspace/bot/node_modules/mongoose/lib/cast.js:305:17)
    at Query.cast (/workspace/bot/node_modules/mongoose/lib/query.js:5055:12)
    at Query._castConditions (/workspace/bot/node_modules/mongoose/lib/query.js:2351:10)
    at model.Query._findOneAndUpdate (/workspace/bot/node_modules/mongoose/lib/query.js:3454:8)
    at model.Query.exec (/workspace/bot/node_modules/mongoose/lib/query.js:4604:80)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async handleStart (/workspace/bot/src/handlers/startHandler.js:65:7)
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17)
    at async /workspace/bot/node_modules/telegraf/lib/composer.js:519:21
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17) {
  isImmutableError: false,
  path: 'userId'
}
ğŸ”„ Config rechargÃ©e depuis la DB
ğŸŒ Menu principal affichÃ© en langue: es
ğŸ“¸ Envoi message avec image: https://i.imgur.com/soi9PbO.jpeg
âœ… Message avec image envoyÃ©
ğŸ”„ Callback reÃ§u: top_plugs
ğŸ‘¤ User ID: 7670522278, Chat ID: 7670522278
ğŸ“ Message ID: 5810
ğŸ“ Context updated to: top_plugs
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ Callback reÃ§u: top_service_meetup_
ğŸ‘¤ User ID: 7670522278, Chat ID: 7670522278
ğŸ“ Message ID: 5810
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: plug_68835c4222586e073b5d57c3_from_top_service
ğŸ‘¤ User ID: 7670522278, Chat ID: 7670522278
ğŸ“ Message ID: 5810
ğŸ“ Context updated to: top_service
ğŸ” handlePlugDetails: plugId=68835c4222586e073b5d57c3, returnContext=top_plugs
ğŸ“¦ Plug found: teste (active: true)
ğŸ–¼ï¸ Images: plug=true, welcome=true, isPlugDetails=true, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/PKYuVrg.jpeg
ğŸ”„ Callback reÃ§u: like_68835c4222586e073b5d57c3
ğŸ‘¤ User ID: 7670522278, Chat ID: 7670522278
ğŸ“ Message ID: 5810
ğŸ” LIKE DEBUG: User 7670522278 veut liker plug 68835c4222586e073b5d57c3
ğŸ“¡ POST /api/likes/68835c4222586e073b5d57c3 - IP: ::1 - UserAgent: node
ğŸ“‹ Headers: [
  'host',
  'connection',
  'content-type',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'user-agent',
  'accept-encoding',
  'content-length'
]
ğŸ”„ API LIKE: like pour plug 68835c4222586e073b5d57c3 par user 7670522278
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
âœ… API LIKE: like rÃ©ussi pour teste. Nouveaux likes: 2
âœ… LIKE rÃ©ussi: teste - 2 likes
ğŸ“¡ POST /api/cache/refresh - IP: ::1 - UserAgent: node
ğŸ“‹ Headers: [
  'host',
  'connection',
  'content-type',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'user-agent',
  'accept-encoding',
  'content-length'
]
ğŸ”„ Demande de rafraÃ®chissement manuel du cache
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ Cache rafraÃ®chi aprÃ¨s vote pour sync web
ğŸ”„ Callback reÃ§u: top_plugs
ğŸ‘¤ User ID: 7670522278, Chat ID: 7670522278
ğŸ“ Message ID: 5810
ğŸ“ Context updated to: top_plugs
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸš€ Commande /start reÃ§ue de: 7548021607
âŒ Erreur lors de l'enregistrement utilisateur: StrictModeError: Path "userId" is not in schema, strict mode is `true`, and upsert is `true`.
    at cast (/workspace/bot/node_modules/mongoose/lib/cast.js:305:17)
    at Query.cast (/workspace/bot/node_modules/mongoose/lib/query.js:5055:12)
    at Query._castConditions (/workspace/bot/node_modules/mongoose/lib/query.js:2351:10)
    at model.Query._findOneAndUpdate (/workspace/bot/node_modules/mongoose/lib/query.js:3454:8)
    at model.Query.exec (/workspace/bot/node_modules/mongoose/lib/query.js:4604:80)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async handleStart (/workspace/bot/src/handlers/startHandler.js:65:7)
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17)
    at async /workspace/bot/node_modules/telegraf/lib/composer.js:519:21
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17) {
  isImmutableError: false,
  path: 'userId'
}
ğŸŒ Menu principal affichÃ© en langue: es
ğŸ“¸ Envoi message avec image: https://i.imgur.com/soi9PbO.jpeg
âœ… Message avec image envoyÃ©
ğŸ”„ Callback reÃ§u: top_plugs
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ“ Context updated to: top_plugs
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: plug_68835c4222586e073b5d57c3_from_top_plugs
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ“ Context updated to: top_plugs
ğŸ” handlePlugDetails: plugId=68835c4222586e073b5d57c3, returnContext=top_plugs
ğŸ“¦ Plug found: teste (active: true)
ğŸ–¼ï¸ Images: plug=true, welcome=true, isPlugDetails=true, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/PKYuVrg.jpeg
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ Callback reÃ§u: like_68835c4222586e073b5d57c3
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ” LIKE DEBUG: User 7548021607 veut liker plug 68835c4222586e073b5d57c3
ğŸ“¡ POST /api/likes/68835c4222586e073b5d57c3 - IP: ::1 - UserAgent: node
ğŸ“‹ Headers: [
  'host',
  'connection',
  'content-type',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'user-agent',
  'accept-encoding',
  'content-length'
]
ğŸ”„ API LIKE: like pour plug 68835c4222586e073b5d57c3 par user 7548021607
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
âœ… API LIKE: like rÃ©ussi pour teste. Nouveaux likes: 3
âœ… LIKE rÃ©ussi: teste - 3 likes
ğŸ“¡ POST /api/cache/refresh - IP: ::1 - UserAgent: node
ğŸ“‹ Headers: [
  'host',
  'connection',
  'content-type',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'user-agent',
  'accept-encoding',
  'content-length'
]
ğŸ”„ Demande de rafraÃ®chissement manuel du cache
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ Cache rafraÃ®chi aprÃ¨s vote pour sync web
ğŸ”„ Callback reÃ§u: top_plugs
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ“ Context updated to: top_plugs
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_country_Suisse
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_country_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_country_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ”„ Callback reÃ§u: top_service_delivery_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_departments_delivery_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ”„ Callback reÃ§u: top_departments_delivery_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ”„ Callback reÃ§u: top_departments_delivery_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ”„ Callback reÃ§u: top_service_meetup_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_departments_meetup_France
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ”„ Callback reÃ§u: plug_68835c4222586e073b5d57c3_from_top_service
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ“ Context updated to: top_service
ğŸ” handlePlugDetails: plugId=68835c4222586e073b5d57c3, returnContext=top_plugs
ğŸ“¦ Plug found: teste (active: true)
ğŸ–¼ï¸ Images: plug=true, welcome=true, isPlugDetails=true, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/PKYuVrg.jpeg
ğŸ”„ Callback reÃ§u: top_plugs
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ“ Context updated to: top_plugs
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
ğŸ”„ Callback reÃ§u: top_reset_filters
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5812
ğŸ” Top Plugs affichÃ© en langue: es
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
âš ï¸ Impossible de modifier l'image, fallback vers Ã©dition caption
âŒ Erreur modification message avec image: TelegramError: 400: Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
    at Telegram.callApi (/workspace/bot/node_modules/telegraf/lib/core/network/client.js:315:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async editMessageWithImage (/workspace/bot/src/utils/messageHelper.js:61:9)
    at async handleTopPlugs (/workspace/bot/src/handlers/plugsHandler.js:80:5)
    at async handleResetFilters (/workspace/bot/src/handlers/plugsHandler.js:445:5)
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17)
    at async /workspace/bot/node_modules/telegraf/lib/composer.js:519:21
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17)
    at async /workspace/bot/node_modules/telegraf/lib/composer.js:519:21
    at async execute (/workspace/bot/node_modules/telegraf/lib/composer.js:518:17) {
  response: {
    ok: false,
    error_code: 400,
    description: 'Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message'
  },
  on: {
    method: 'editMessageCaption',
    payload: {
      chat_id: 7548021607,
      message_id: 5812,
      inline_message_id: undefined,
      reply_markup: [Object],
      parse_mode: 'Markdown',
      caption: 'ğŸ” Top Tiendas\n' +
        '*(Ordenados por nÃºmero de votos)*\n' +
        '\n' +
        '**1 tiendas disponibles :**\n' +
        '\n'
    }
  }
}
ğŸ”„ RafraÃ®chissement du cache...
âœ… Cache mis Ã  jour - 1 plugs, config: OK
ğŸ”„ Callback reÃ§u: back_main
ğŸ‘¤ User ID: 7548021607, Chat ID: 7548021607
ğŸ“ Message ID: 5813
ğŸ”™ Retour au menu principal demandÃ©
ğŸ“‹ Configuration rÃ©cupÃ©rÃ©e pour le retour
ğŸŒ Langue actuelle pour le retour: es
ğŸ“ Message d'accueil prÃ©parÃ© pour le retour avec traduction
ğŸ–¼ï¸ Images: plug=false, welcome=true, isPlugDetails=false, using=true
ğŸ–¼ï¸ Modification avec image: https://i.imgur.com/soi9PbO.jpeg
âœ… Retour au menu principal terminÃ©
