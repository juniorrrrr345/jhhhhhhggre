🔄 Tentative de connexion MongoDB #1...
✅ MongoDB connecté avec succès
✅ MongoDB connecté: ac-rxln3be-shard-00-00.oghzx2v.mongodb.net
ℹ️ Configuration existante trouvée
🔄 Migration automatique des réseaux sociaux...
🔗 Connexion à MongoDB réussie
📋 2 plugs trouvés
🎉 Migration terminée: 0 plugs migrés
✅ Migration terminée avec succès
🔄 Initialisation du cache...
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
✅ Cache initialisé et programmé pour se rafraîchir toutes les 30s
✅ Bot en mode polling (développement)
✅ Serveur démarré sur le port 3000
📱 Bot Telegram connecté
🌐 API disponible sur http://localhost:3000
📊 Cache: 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
📡 GET /api/users/stats - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔐 Tentative d'authentification: GET /api/users/stats
📋 Headers reçus: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
⚠️ MongoDB déconnecté
✅ MongoDB connecté avec succès
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /admin-panel - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 PUT /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔐 Tentative d'authentification: PUT /api/config
📋 Headers reçus: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔧 Début mise à jour configuration...
📊 Taille des données reçues: 184 caractères
📋 Clés principales: [ 'interface' ]
📝 Données après nettoyage: [ 'interface', 'updatedAt' ]
💾 Mise à jour configuration existante...
✅ Configuration mise à jour avec succès
📊 ID du document: main
🔄 Rechargement de la configuration du bot...
✅ Configuration rechargée avec succès
✅ Configuration du bot rechargée automatiquement
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/proxy - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/proxy - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
📡 GET /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔐 Tentative d'authentification: GET /api/config
📋 Headers reçus: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
📡 GET / - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔐 Tentative d'authentification: GET /api/config
📋 Headers reçus: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 PUT /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔐 Tentative d'authentification: PUT /api/config
📋 Headers reçus: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔧 Début mise à jour configuration...
📊 Taille des données reçues: 199 caractères
📋 Clés principales: [ 'interface' ]
📝 Données après nettoyage: [ 'interface', 'updatedAt' ]
💾 Mise à jour configuration existante...
✅ Configuration mise à jour avec succès
📊 ID du document: main
🔄 Rechargement de la configuration du bot...
✅ Configuration rechargée avec succès
✅ Configuration du bot rechargée automatiquement
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 POST /api/cache/refresh - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔄 Demande de rafraîchissement manuel du cache
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 PUT /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔐 Tentative d'authentification: PUT /api/config
📋 Headers reçus: [
  'host',
  'user-agent',
  'accept',
  'authorization',
  'content-type',
  'content-length'
]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔧 Début mise à jour configuration...
📊 Taille des données reçues: 200 caractères
📋 Clés principales: [ 'interface' ]
📝 Données après nettoyage: [ 'interface', 'updatedAt' ]
💾 Mise à jour configuration existante...
✅ Configuration mise à jour avec succès
📊 ID du document: main
🔄 Rechargement de la configuration du bot...
✅ Configuration rechargée avec succès
✅ Configuration du bot rechargée automatiquement
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔐 Tentative d'authentification: GET /api/config
📋 Headers reçus: [ 'host', 'user-agent', 'accept', 'authorization' ]
🔑 Authorization header: Bearer ***n123
🔍 Password fourni: ***n123
🔍 Password attendu configuré: Oui
✅ Authentification réussie
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/config - IP: ::1 - UserAgent: Vercel-Proxy/1.0
📋 Headers: [
  'host',
  'connection',
  'content-type',
  'user-agent',
  'cache-control',
  'accept',
  'authorization',
  'accept-language',
  'sec-fetch-mode',
  'accept-encoding'
]
🔐 Tentative d'authentification: GET /api/config
📋 Headers reçus: [
  'host',
  'connection',
  'content-type',
  'user-agent',
  'cache-control',
  'accept',
  'authorization',
  'accept-language',
  'sec-fetch-mode',
  'accept-encoding'
]
🔑 Authorization header: Bearer ***oken
🔍 Password fourni: ***oken
🔍 Password attendu configuré: Oui
❌ Password incorrect
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🚀 Commande /start reçue de: 7670522278
📋 Config trouvée: true
📝 Message d'accueil préparé: Coucx...
📸 Envoi avec image: https://imgur.com/KiiG9Qu.jpg
✅ Message avec image envoyé
✅ Commande /start terminée avec succès
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: Vercel-Proxy/1.0
📋 Headers: [
  'host',
  'connection',
  'content-type',
  'user-agent',
  'cache-control',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'accept-encoding'
]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config/fresh - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
📡 POST /api/refresh-shop-cache - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
📡 GET /api/public/config - IP: ::1 - UserAgent: curl/8.12.1
📋 Headers: [ 'host', 'user-agent', 'accept' ]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
📡 GET /api/public/config - IP: ::1 - UserAgent: Vercel-Proxy/1.0
📋 Headers: [
  'host',
  'connection',
  'content-type',
  'user-agent',
  'cache-control',
  'accept',
  'accept-language',
  'sec-fetch-mode',
  'accept-encoding'
]
🔍 Récupération config publique pour la boutique
📊 Config récupérée pour boutique: { boutique: 'Testee', logo: 'Non défini', background: 'Défini' }
🔄 Rafraîchissement du cache...
✅ Cache mis à jour - 2 plugs, config: OK
/workspace/bot/node_modules/telegraf/lib/core/network/client.js:315
            throw new error_1.default(data, { method, payload });
                  ^

TelegramError: 409: Conflict: terminated by setWebhook request
    at Telegram.callApi (/workspace/bot/node_modules/telegraf/lib/core/network/client.js:315:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async [Symbol.asyncIterator] (/workspace/bot/node_modules/telegraf/lib/core/network/polling.js:30:33)
    at async Polling.loop (/workspace/bot/node_modules/telegraf/lib/core/network/polling.js:73:30)
    at async Telegraf.launch (/workspace/bot/node_modules/telegraf/lib/telegraf.js:194:13) {
  response: {
    ok: false,
    error_code: 409,
    description: 'Conflict: terminated by setWebhook request'
  },
  on: {
    method: 'getUpdates',
    payload: { timeout: 50, offset: 891033312, allowed_updates: [] }
  }
}

Node.js v22.16.0
